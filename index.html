<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApulianChain Calendar | Crypto & AI Events 2026+</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS MODERNO (CSS3+) --- */
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #3b82f6; /* Blue Tech */
            --accent-glow: rgba(59, 130, 246, 0.5);
            --success: #10b981;
            --warning: #f59e0b;
            --border-radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
        }

        h1, h2, h3 { font-family: 'Space Grotesk', sans-serif; }

        /* HEADER */
        header {
            padding: 2rem 5%;
            background: linear-gradient(180deg, rgba(15,23,42,1) 0%, rgba(15,23,42,0) 100%);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand { font-size: 1.5rem; font-weight: bold; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; }
        .brand span { color: #fff; }

        /* FILTRI */
        .filters {
            display: flex;
            gap: 10px;
            padding: 1rem 5%;
            overflow-x: auto;
            white-space: nowrap;
        }

        .filter-btn {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-main);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
            border-color: var(--accent);
        }

        /* LAYOUT GRIGLIA */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            padding: 2rem 5%;
            max-width: 1600px;
            margin: 0 auto;
        }

        @media (max-width: 900px) {
            .main-container { grid-template-columns: 1fr; }
            #map-column { order: -1; height: 300px; }
        }

        /* LISTA EVENTI */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .event-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.05);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }

        .event-card:hover { transform: translateY(-5px); border-color: var(--accent); }

        .category-tag {
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .event-date { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.5rem; }
        .event-location { color: var(--success); font-size: 0.9rem; margin-top: 0.5rem; }

        /* MAPPA */
        #map {
            height: 100%;
            min-height: 400px;
            border-radius: var(--border-radius);
            z-index: 1;
        }

        /* MODALE / FORM AGGIUNTA */
        .add-event-section {
            background: rgba(30, 41, 59, 0.5);
            padding: 2rem 5%;
            margin-top: 2rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .form-group { margin-bottom: 1rem; }
        input, select, textarea {
            width: 100%;
            padding: 0.8rem;
            background: #0f172a;
            border: 1px solid #334155;
            color: white;
            border-radius: 8px;
            font-family: inherit;
        }
        button.submit-btn {
            width: 100%;
            padding: 1rem;
            background: var(--success);
            color: #000;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-transform: uppercase;
        }
        button.submit-btn:hover { opacity: 0.9; }

        /* NOTIFICHE */
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--warning);
            color: #000;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 9999;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        footer { text-align: center; padding: 3rem; color: var(--text-muted); font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="notification-area" class="notification-toast">
        üîî Evento imminente rilevato tra le tue crew preferite!
    </div>

    <header>
        <div class="brand">Apulian<span>Chain</span></div>
        <button onclick="document.getElementById('add-event-form').scrollIntoView({behavior: 'smooth'})" style="background:transparent; border:1px solid var(--accent); color:var(--accent); padding:0.5rem 1rem; border-radius:4px; cursor:pointer;">+ Aggiungi Evento</button>
    </header>

    <div class="filters">
        <button class="filter-btn active" onclick="filterEvents('all')">Tutti</button>
        <button class="filter-btn" onclick="filterEvents('Crypto')">Crypto</button>
        <button class="filter-btn" onclick="filterEvents('Blockchain')">Blockchain</button>
        <button class="filter-btn" onclick="filterEvents('Finanza')">Finanza</button>
        <button class="filter-btn" onclick="filterEvents('AI')">AI</button>
    </div>

    <div class="main-container">
        <div id="events-list" class="events-grid">
            </div>

        <div id="map-column">
            <div id="map"></div>
        </div>
    </div>

    <div class="add-event-section" id="add-event-form">
        <h2 style="margin-bottom: 1rem;">Aggiungi Evento Crew</h2>
        <form id="newEventForm">
            <div class="form-group">
                <input type="text" id="title" placeholder="Nome Evento" required>
            </div>
            <div class="form-group">
                <select id="category">
                    <option value="Crypto">Crypto</option>
                    <option value="Blockchain">Blockchain</option>
                    <option value="Finanza">Finanza</option>
                    <option value="AI">AI</option>
                </select>
            </div>
            <div class="form-group">
                <input type="date" id="date" min="2026-01-01" required>
                <small style="color:gray">Dal 2026 in poi</small>
            </div>
            <div class="form-group">
                <input type="text" id="city" placeholder="Citt√† (es. Bari, Milano)" required>
            </div>
            <button type="submit" class="submit-btn">Invia alla Crew</button>
        </form>
    </div>

    <footer>
        <p>Firmato <strong>ApulianChain</strong> | Aggregatore Eventi Italiani 2026+</p>
        <p>Open Source & Community Driven</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        // --- 1. CONFIGURAZIONE & DATI MOCK (Sostituire con le tue API in futuro) ---
        
        // Questo array simula il database JSON o la risposta dell'API Aggregatore
        let eventsData = [
            { id: 1, title: "Apulian Blockchain Summit", date: "2026-03-15", category: "Blockchain", city: "Bari", lat: 41.1171, lon: 16.8719, desc: "Il ritrovo delle crew del sud." },
            { id: 2, title: "Milan AI Week 2026", date: "2026-05-10", category: "AI", city: "Milano", lat: 45.4642, lon: 9.1900, desc: "Innovazione e Reti Neurali." },
            { id: 3, title: "Crypto Finance Forum", date: "2026-02-20", category: "Finanza", city: "Roma", lat: 41.9028, lon: 12.4964, desc: "Il futuro della DeFi." },
            { id: 4, title: "Web3 Hackathon Italia", date: "2026-06-01", category: "Crypto", city: "Torino", lat: 45.0703, lon: 7.6869, desc: "Costruiamo su chain." },
            // Evento "tra 3 giorni" (dinamico per testare notifica)
            { id: 99, title: "Evento Imminente Test", date: getDateInDays(3), category: "Blockchain", city: "Napoli", lat: 40.8518, lon: 14.2681, desc: "Test notifiche." }
        ];

        // --- 2. INIZIALIZZAZIONE MAPPA (Leaflet) ---
        const map = L.map('map').setView([41.8719, 12.5674], 5); // Centrato sull'Italia
        
        // Carica Tiles gratuite da OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> contributors',
            maxZoom: 19
        }).addTo(map);

        let markers = [];

        // --- 3. FUNZIONI LOGICHE ---

        // A. Renderizza Eventi e Marcatori
        function renderEvents(filterCategory) {
            const container = document.getElementById('events-list');
            container.innerHTML = ''; // Pulisci lista
            
            // Rimuovi vecchi marker
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            eventsData.forEach(event => {
                if (filterCategory === 'all' || event.category === filterCategory) {
                    
                    // 1. Crea Card HTML
                    const card = document.createElement('div');
                    card.className = 'event-card';
                    card.innerHTML = `
                        <span class="category-tag">${event.category}</span>
                        <h3>${event.title}</h3>
                        <div class="event-date">üìÖ ${event.date}</div>
                        <p style="font-size:0.9rem; color:#ccc">${event.desc}</p>
                        <div class="event-location">üìç ${event.city}</div>
                    `;
                    container.appendChild(card);

                    // 2. Aggiungi Marker su Mappa
                    const marker = L.marker([event.lat, event.lon])
                        .addTo(map)
                        .bindPopup(`<b>${event.title}</b><br>${event.date}`);
                    markers.push(marker);
                }
            });
        }

        // B. Logica Notifiche (3 giorni prima)
        function checkNotifications() {
            const today = new Date();
            const notificationArea = document.getElementById('notification-area');
            let hasIncoming = false;

            eventsData.forEach(event => {
                const eventDate = new Date(event.date);
                const diffTime = eventDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

                // Se l'evento √® tra 0 e 3 giorni
                if (diffDays >= 0 && diffDays <= 3) {
                    hasIncoming = true;
                    notificationArea.innerHTML = `üîî <strong>${event.title}</strong> tra ${diffDays} giorni a ${event.city}!`;
                }
            });

            if (hasIncoming) {
                notificationArea.style.display = 'block';
                // Nascondi dopo 5 secondi
                setTimeout(() => { notificationArea.style.display = 'none'; }, 8000);
            }
        }

        // C. Gestione Aggiunta Manuale
        document.getElementById('newEventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // In uno scenario reale, qui faresti una POST alle API o a Google Sheets
            const newEvent = {
                id: eventsData.length + 1,
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                city: document.getElementById('city').value,
                lat: 41.9028, // Default Roma (in prod serve geocoding api)
                lon: 12.4964,
                desc: "Evento aggiunto dalla community"
            };

            eventsData.push(newEvent);
            renderEvents('all'); // Ricarica
            alert('Evento proposto con successo! In attesa di validazione ApulianChain.');
            this.reset();
        });

        // D. Filtri UI
        window.filterEvents = function(cat) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderEvents(cat);
        }

        // Helper per generare date future (per la demo)
        function getDateInDays(days) {
            const date = new Date();
            date.setDate(date.getDate() + days);
            return date.toISOString().split('T')[0];
        }

        // --- AVVIO ---
        // Simula chiamata API all'avvio
        document.addEventListener('DOMContentLoaded', () => {
            /* QUI DOVRESTI SOSTITUIRE "eventsData" CON:
               fetch('https://tua-api-o-json-su-github.com/events.json')
                 .then(res => res.json())
                 .then(data => { eventsData = data; renderEvents('all'); });
            */
            
            renderEvents('all');
            checkNotifications();
        });

    </script>
</body>
</html>
